<!DOCTYPE html>
<html>
  <head>
    <title>Flat Screen VR Casino</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  </head>

  <body>
    <a-scene>

      <!-- Assets -->
      <a-assets>
        <video id="initVid" src="init.mp4" loop="false"></video>
        <video id="betVid" src="Bet.mov" loop="false"></video>
        <video id="hitLoseVid" src="Hit1andPlayerLose.mov" loop="false"></video>
        <video id="standVid" src="Stand1.mov" loop="false"></video>
        <video id="standWinVid" src="PlayerWinAfterStand.mov" loop="false"></video>
      </a-assets>

      <!-- Camera with gaze cursor -->
      <a-entity camera look-controls wasd-controls-enabled="false" position="0 1.6 0">
        <a-cursor 
          fuse="true" 
          fuse-timeout="1500"
          raycaster="objects: .clickable"
          material="color: yellow; shader: flat"
          geometry="radiusInner: 0.01; radiusOuter: 0.02">
        </a-cursor>
      </a-entity>

      <!-- Video Screen -->
      <a-plane
        id="screen"
        position="0 1.6 -2"
        width="2.5"
        height="1.4"
        material="shader: flat; src: #initVid">
      </a-plane>

      <!-- Buttons -->
      <a-box id="betButton" class="clickable button"
             position="0 0.6 -2" width="0.6" height="0.25" depth="0.05" color="green">
        <a-text value="BET" align="center" position="0 0 0.03"></a-text>
      </a-box>

      <a-box id="hitButton" class="clickable button"
             position="-0.5 0.2 -2" width="0.6" height="0.25" depth="0.05" color="red"
             visible="false">
        <a-text value="HIT" align="center" position="0 0 0.03"></a-text>
      </a-box>

      <a-box id="standButton" class="clickable button"
             position="0.5 0.2 -2" width="0.6" height="0.25" depth="0.05" color="blue"
             visible="false">
        <a-text value="STAND" align="center" position="0 0 0.03"></a-text>
      </a-box>

      <!-- Logic -->
      <script>
        const screen = document.querySelector('#screen');

        const initVid = document.querySelector('#initVid');
        const betVid = document.querySelector('#betVid');
        const hitLoseVid = document.querySelector('#hitLoseVid');
        const standVid = document.querySelector('#standVid');
        const standWinVid = document.querySelector('#standWinVid');

        const betBtn = document.querySelector('#betButton');
        const hitBtn = document.querySelector('#hitButton');
        const standBtn = document.querySelector('#standButton');

        initVid.play();

        function playVideo(video) {
          screen.setAttribute('material', 'shader: flat; src', '#' + video.id);
          video.currentTime = 0;
          video.play();
        }

        // Helper: Add gaze feedback animation
        function addGazeFeedback(button) {
          button.addEventListener('mouseenter', () => {
            // Animate scale up
            button.setAttribute('animation__scale', {
              property: 'scale',
              to: '1.2 1.2 1.2',
              dur: 1500,
              easing: 'linear'
            });
          });

          button.addEventListener('mouseleave', () => {
            // Animate scale back
            button.removeAttribute('animation__scale'); 
            button.setAttribute('scale', '1 1 1');
          });
        }

        // Apply gaze feedback to all buttons
        [betBtn, hitBtn, standBtn].forEach(addGazeFeedback);

        // BET button logic
        betBtn.addEventListener('mouseenter', () => {
          playVideo(betVid);
          betBtn.setAttribute('visible', false);

          betVid.onended = () => {
            hitBtn.setAttribute('visible', true);
            standBtn.setAttribute('visible', true);
          };
        });

        // HIT button logic
        hitBtn.addEventListener('mouseenter', () => {
          hitBtn.setAttribute('visible', false);
          standBtn.setAttribute('visible', false);
          playVideo(hitLoseVid);
        });

        // STAND button logic
        standBtn.addEventListener('mouseenter', () => {
          hitBtn.setAttribute('visible', false);
          standBtn.setAttribute('visible', false);
          playVideo(standVid);

          standVid.onended = () => {
            playVideo(standWinVid);
          };
        });
      </script>

    </a-scene>
  </body>
</html>
