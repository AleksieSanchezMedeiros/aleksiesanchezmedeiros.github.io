<!DOCTYPE html>
<html>
  <head>
    <title>Flat Screen VR Casino</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script>
      AFRAME.registerComponent('casino-logic', {
        init: function () {
          const screen = document.querySelector('#main-video');
          const betBtn = document.querySelector('#bet-button');

          // Helper function to swap video source and play
          const playVideo = (id) => {
            const videoAsset = document.querySelector(id);
            screen.setAttribute('src', id);
            videoAsset.play();
          };

          betBtn.addEventListener('click', () => {
            // 1. Play "Initial Bet"
            playVideo('#vid_bet');

            // 2. When "Bet" video ends, show cards
            document.querySelector('#vid_bet').onended = () => {
              playVideo('#vid_show_cards');
            };

            // 3. When "Show Cards" ends, pick a random outcome
            document.querySelector('#vid_show_cards').onended = () => {
              const outcomes = ['#vid_win', '#vid_lose'];
              const randomResult = outcomes[Math.floor(Math.random() * outcomes.length)];
              playVideo(randomResult);
            };
          });
        }
      });
    </script>
  </head>
  <body style="background-color: #000;">
    <a-scene casino-logic>
      <a-assets>
        <video id="vid_begin" src="init.mp4" loop="true" crossorigin="anonymous" playsinline webkit-playsinline></video>
        <video id="vid_bet" src="bet1.mp4" crossorigin="anonymous" playsinline webkit-playsinline></video>
        <video id="vid_show_cards" src="hit1.mp4" crossorigin="anonymous" playsinline webkit-playsinline></video>
        <video id="vid_win" src="win1.mp4" crossorigin="anonymous" playsinline webkit-playsinline></video>
        <video id="vid_lose" src="loss1.mp4" crossorigin="anonymous" playsinline webkit-playsinline></video>
      </a-assets>

      <a-video id="main-video" src="#vid_begin" position="0 1.6 -4" width="4" height="2.25"></a-video>

      <a-plane rotation="-90 0 0" width="10" height="10" color="#111"></a-plane>

      <a-camera>
        <a-cursor fuse="true" fuse-timeout="1500" color="yellow"></a-cursor>
      </a-camera>

      <a-box id="bet-button" position="0 0.5 -3" color="green" scale="1 0.4 0.1">
        <a-text value="STARE TO BET" align="center" position="0 0 0.6" scale="0.8" color="white"></a-text>
      </a-box>

    </a-scene>
  </body>
</html>
