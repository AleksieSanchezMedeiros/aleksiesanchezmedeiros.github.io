<!DOCTYPE html>
<html>
  <head>
    <title>Flat Screen VR Casino</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  </head>

  <body>
    <a-scene>

      <!-- Assets -->
      <a-assets>
        <video id="betVid" src="Bet.mov" loop="false" muted playsinline crossorigin="anonymous"></video>
        <video id="hitLoseVid" src="Hit1andPlayerLose.mov" loop="false" muted playsinline crossorigin="anonymous"></video>
        <video id="standVid" src="Stand1.mov" loop="false" muted playsinline crossorigin="anonymous"></video>
        <video id="standWinVid" src="PlayerWin.mov" loop="false" muted playsinline crossorigin="anonymous"></video>
        <video id="dealVid" src="Deal Cards.mov" loop="false" muted playsinline crossorigin="anonymous"></video>
        <audio id="bgMusic" src="casino_bg.mp3" loop></audio>
        <video id="initVid" src="init.mp4" loop="false" muted playsinline crossorigin="anonymous"></video>

      </a-assets>

      <!-- Camera with gaze cursor -->
      <a-entity camera look-controls wasd-controls-enabled="false" position="0 1.6 0">
        <a-cursor 
          fuse="true" 
          fuse-timeout="1500"
          raycaster="objects: .clickable"
          material="color: yellow; shader: flat"
          geometry="radiusInner: 0.01; radiusOuter: 0.02">
        </a-cursor>
      </a-entity>

      <!-- Video Screen -->
      <a-plane
  id="screen"
  position="0 1.6 -1.1"
  width="2.5"
  height="1.4"
  material="shader: flat; src: #initVid"
  raycastable="false">
</a-plane>

      <!-- Buttons -->
      <a-box id="betButton" class="clickable button"
             position="0 1.2 -1" width="0.6" height="0.25" depth="0.05" color="green">
        <a-text value="BET" align="center" position="0 0 0.03"></a-text>
      </a-box>

      <a-box id="hitButton" class="clickable button"
             position="-0.5 1.2 -1" width="0.6" height="0.25" depth="0.05" color="red"
             visible="false">
        <a-text value="HIT" align="center" position="0 0 0.03"></a-text>
      </a-box>

      <a-box id="standButton" class="clickable button"
             position="0.5 1.2 -1" width="0.6" height="0.25" depth="0.05" color="blue"
             visible="false">
        <a-text value="STAND" align="center" position="0 0 0.03"></a-text>
      </a-box>

      <!-- Logic -->
      <script>
        let bgStarted = false;
        const screen = document.querySelector('#screen');

        const initVid = document.querySelector('#initVid');
        const betVid = document.querySelector('#betVid');
        const hitLoseVid = document.querySelector('#hitLoseVid');
        const standVid = document.querySelector('#standVid');
        const standWinVid = document.querySelector('#standWinVid');
        const dealVid = document.querySelector('#dealVid');

        const betBtn = document.querySelector('#betButton');
        const hitBtn = document.querySelector('#hitButton');
        const standBtn = document.querySelector('#standButton');

        // Play initial video (needs user gesture for autoplay on some devices)
        initVid.play().catch(() => {
          console.log("Init video will play on first user interaction.");
        });

        // Helper: play video on screen safely
  function playVideo(video) {
    // Stop all videos first (important for mobile)
    [initVid, betVid, dealVid, hitLoseVid, standVid, standWinVid].forEach(v => {
  v.pause();
  v.currentTime = 0;
});


    // Update the screen texture FIRST
    screen.setAttribute('material', {
      shader: 'flat',
      src: `#${video.id}`
    });

    // Then play
    video.play().catch(err => {
      console.warn('Video play blocked:', err);
    });
  }


        // Add gaze feedback (scale animation)
        function addGazeFeedback(button) {
          button.addEventListener('mouseenter', () => {
            button.setAttribute('animation__scale', {
              property: 'scale',
              to: '1.2 1.2 1.2',
              dur: 1500,
              easing: 'linear'
            });
          });
          button.addEventListener('mouseleave', () => {
            button.removeAttribute('animation__scale'); 
            button.setAttribute('scale', '1 1 1');
          });
        }

        [betBtn, hitBtn, standBtn].forEach(addGazeFeedback);

        // === Button logic using fuse-triggered click ===

        // BET button
        betBtn.addEventListener('click', () => {

  if (!bgStarted) {
    const bg = document.querySelector('#bgMusic');
    bg.volume = 0.6; // nice casino ambience
    bg.play().catch(() => {});
    bgStarted = true;
  }

  betBtn.setAttribute('visible', false);
  playVideo(betVid);

  betVid.onended = () => {
    playVideo(dealVid);

    dealVid.onended = () => {
      hitBtn.setAttribute('visible', true);
      standBtn.setAttribute('visible', true);
    };
  };
});


        // HIT button
        hitBtn.addEventListener('click', () => {
          hitBtn.setAttribute('visible', false);
          standBtn.setAttribute('visible', false);
          playVideo(hitLoseVid);
        });

        // STAND button
        standBtn.addEventListener('click', () => {
          hitBtn.setAttribute('visible', false);
          standBtn.setAttribute('visible', false);
          playVideo(standVid);

          standVid.onended = () => {
            playVideo(standWinVid);
          };
        });
      </script>

    </a-scene>
  </body>
</html>
